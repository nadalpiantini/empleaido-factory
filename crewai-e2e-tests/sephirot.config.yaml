# Sephirot Orchestration Configuration for Empleaido Factory E2E Tests
# Coordinates CrewAI agents with Playwright for comprehensive testing

version: "1.0"
name: "empleaido-factory-e2e"
description: "Full user journey testing from landing to purchase using AI agents"

# Global Configuration
config:
  baseURL: "http://localhost:3000"
  headed: true
  slowMo: 100
  screenshotOnFailure: true
  videoRecording: true
  parallelExecutions: false  # Sequential for E2E flows

# Agent Definitions
agents:
  - id: "landing-explorer"
    name: "Landing Explorer"
    type: "CrewAgent"
    role: "Landing Page QA Specialist"
    goal: "Thoroughly test landing page UX, design, and functionality"
    backstory: |
      Expert UX tester with 10+ years experience evaluating landing pages.
      Keen eye for visual design, navigation, content clarity, performance,
      and mobile responsiveness issues.
    capabilities:
      - "visual_testing"
      - "navigation_testing"
      - "accessibility_testing"
      - "performance_analysis"
    tools:
      - "playwright_browser"
      - "screenshot_capture"
      - "console_logger"
    maxIterations: 10
    memory: true

  - id: "onboarding-tester"
    name: "Onboarding Tester"
    type: "CrewAgent"
    role: "Onboarding Flow QA Specialist"
    goal: "Test complete signup/onboarding flow from entry to dashboard"
    backstory: |
      Expert in user onboarding experiences. Tests signup processes,
      step-by-step guidance, form validation, progress indicators,
      and successful completion leading to dashboard access.
    capabilities:
      - "form_testing"
      - "validation_testing"
      - "flow_completion"
      - "redirect_testing"
    tools:
      - "playwright_browser"
      - "form_interactor"
      - "url_tracker"
    maxIterations: 15
    memory: true
    allowDelegation: false

  - id: "catalog-navigator"
    name: "Catalog Navigator"
    type: "CrewAgent"
    role: "Product Catalog Explorer"
    goal: "Test empleaido catalog functionality, search, and product details"
    backstory: |
      Expert e-commerce catalog tester. Examines product listings,
      filtering, sorting, search functionality, product detail pages,
      image quality, pricing display, and purchase flow entry points.
    capabilities:
      - "catalog_navigation"
      - "product_testing"
      - "search_testing"
      - "filter_testing"
    tools:
      - "playwright_browser"
      - "product_scraper"
      - "screenshot_capture"
    maxIterations: 12
    memory: true

  - id: "purchase-tester"
    name: "Purchase Flow Tester"
    type: "CrewAgent"
    role: "Checkout and Purchase Specialist"
    goal: "Test complete purchase flow from product selection to completion"
    backstory: |
      Expert in e-commerce checkout flows. Tests add to cart, cart management,
      checkout process, payment integration, order confirmation, auth requirements,
      and error handling throughout the purchase journey.
    capabilities:
      - "cart_testing"
      - "checkout_testing"
      - "payment_testing"
      - "auth_requirement_testing"
    tools:
      - "playwright_browser"
      - "form_interactor"
      - "checkout_simulator"
    maxIterations: 15
    memory: true
    allowDelegation: false

  - id: "bug-hunter"
    name: "Bug Hunter"
    type: "CrewAgent"
    role: "Issue Detection and Reporting Specialist"
    goal: "Identify, categorize, and document all issues found during testing"
    backstory: |
      Expert QA analyst with meticulous attention to detail. Identifies bugs,
      usability issues, performance problems, and suggests improvements.
      Creates comprehensive bug reports with severity ratings and screenshots.
    capabilities:
      - "issue_detection"
      - "severity_assessment"
      - "documentation"
      - "screenshot_analysis"
    tools:
      - "screenshot_analyzer"
      - "console_log_parser"
      - "report_generator"
    maxIterations: 20
    memory: true
    verbose: true

# Task Definitions (Hierarchical)
tasks:
  # Level 1: High-level test suites
  - id: "test-landing-suite"
    name: "Test Landing Page Suite"
    description: "Execute comprehensive landing page tests"
    agent: "landing-explorer"
    priority: "high"
    expectedOutput: "Detailed report of landing page issues with severity ratings"
    dependencies: []
    async: false

  - id: "test-onboarding-suite"
    name: "Test Onboarding Flow Suite"
    description: "Execute complete onboarding flow tests"
    agent: "onboarding-tester"
    priority: "high"
    expectedOutput: "Report of onboarding flow issues including validation errors"
    dependencies: []
    async: false

  - id: "test-catalog-suite"
    name: "Test Catalog Suite"
    description: "Execute catalog and product listing tests"
    agent: "catalog-navigator"
    priority: "high"
    expectedOutput: "Report of catalog functionality issues"
    dependencies: []
    async: false

  - id: "test-purchase-suite"
    name: "Test Purchase Flow Suite"
    description: "Execute complete purchase flow tests"
    agent: "purchase-tester"
    priority: "high"
    expectedOutput: "Report of purchase flow issues from cart to completion"
    dependencies: []
    async: false

  # Level 2: Detailed subtasks
  - id: "landing-hero-test"
    name: "Test Hero Section"
    description: "Test landing page hero section visibility, CTA buttons, and headlines"
    agent: "landing-explorer"
    priority: "medium"
    expectedOutput: "Hero section test results"
    dependencies: ["test-landing-suite"]
    async: false

  - id: "landing-navigation-test"
    name: "Test Navigation"
    description: "Test navigation menu, links, and accessibility"
    agent: "landing-explorer"
    priority: "medium"
    expectedOutput: "Navigation test results"
    dependencies: ["test-landing-suite"]
    async: false

  - id: "landing-content-test"
    name: "Test Content Sections"
    description: "Test content sections, images, and media"
    agent: "landing-explorer"
    priority: "medium"
    expectedOutput: "Content sections test results"
    dependencies: ["test-landing-suite"]
    async: false

  - id: "onboarding-entry-test"
    name: "Test Onboarding Entry"
    description: "Test onboarding entry points and route accessibility"
    agent: "onboarding-tester"
    priority: "medium"
    expectedOutput: "Entry point test results"
    dependencies: ["test-onboarding-suite"]
    async: false

  - id: "onboarding-forms-test"
    name: "Test Onboarding Forms"
    description: "Test onboarding forms, validation, and submission"
    agent: "onboarding-tester"
    priority: "medium"
    expectedOutput: "Form validation test results"
    dependencies: ["test-onboarding-suite"]
    async: false

  - id: "catalog-listings-test"
    name: "Test Product Listings"
    description: "Test product card display and information"
    agent: "catalog-navigator"
    priority: "medium"
    expectedOutput: "Product listing test results"
    dependencies: ["test-catalog-suite"]
    async: false

  - id: "catalog-details-test"
    name: "Test Product Details"
    description: "Test individual product detail pages"
    agent: "catalog-navigator"
    priority: "medium"
    expectedOutput: "Product detail test results"
    dependencies: ["test-catalog-suite"]
    async: false

  - id: "purchase-flow-test"
    name: "Test Purchase Button Flow"
    description: "Test clicking purchase button and subsequent navigation"
    agent: "purchase-tester"
    priority: "medium"
    expectedOutput: "Purchase flow test results"
    dependencies: ["test-purchase-suite"]
    async: false

  - id: "checkout-test"
    name: "Test Checkout Process"
    description: "Test checkout page and form elements"
    agent: "purchase-tester"
    priority: "medium"
    expectedOutput: "Checkout test results"
    dependencies: ["test-purchase-suite"]
    async: false

  # Level 3: Bug reporting task
  - id: "compile-bug-report"
    name: "Compile Comprehensive Bug Report"
    description: "Compile all issues from all test suites into comprehensive report"
    agent: "bug-hunter"
    priority: "critical"
    expectedOutput: "Complete bug report with severity ratings and recommendations"
    dependencies: [
      "test-landing-suite",
      "test-onboarding-suite",
      "test-catalog-suite",
      "test-purchase-suite"
    ]
    async: false
    context:
      includeScreenshots: true
      includeConsoleLogs: true
      includeVideoPaths: true
      severityRatings: ["critical", "high", "medium", "low"]
      outputFormat: "json"

# Crew Configuration (Hierarchical Execution)
crews:
  - id: "full-journey-test-crew"
    name: "Full User Journey Test Crew"
    description: "Tests complete user journey from landing to purchase"
    process: "hierarchical"  # hierarchical, sequential, or parallel
    agents:
      - "landing-explorer"
      - "onboarding-tester"
      - "catalog-navigator"
      - "purchase-tester"
    tasks:
      - "test-landing-suite"
      - "test-onboarding-suite"
      - "test-catalog-suite"
      - "test-purchase-suite"
      - "compile-bug-report"
    managerAgent: "bug-hunter"
    verbose: true
    memory: true

  - id: "quick-smoke-test-crew"
    name: "Quick Smoke Test Crew"
    description: "Fast smoke tests for critical functionality"
    process: "parallel"
    agents:
      - "landing-explorer"
      - "catalog-navigator"
    tasks:
      - "landing-hero-test"
      - "catalog-listings-test"
    verbose: true
    memory: false

# Execution Flow
executionPlan:
  phases:
    - phase: "pre-test"
      name: "Setup and Initialization"
      actions:
        - "Launch browser"
        - "Initialize screenshot/video recording"
        - "Verify dev server is running"
        - "Clear browser cache and cookies"

    - phase: "test-execution"
      name: "Execute Test Suites"
      crew: "full-journey-test-crew"
      actions:
        - "Run landing page tests"
        - "Run onboarding tests"
        - "Run catalog tests"
        - "Run purchase flow tests"
        - "Capture screenshots after each test"
        - "Record console errors"

    - phase: "post-test"
      name: "Compilation and Reporting"
      actions:
        - "Stop video recording"
        - "Compile all issues into bug report"
        - "Generate JSON report file"
        - "Print summary to console"
        - "Save all screenshots"
        - "Close browser"

# Output Configuration
output:
  screenshotDir: "./screenshots"
  videoDir: "./videos"
  traceDir: "./traces"
  reportDir: "./reports"
  logFile: "./test-execution.log"
  formats:
    - "json"     # Machine-readable detailed report
    - "console"  # Human-readable console output
    - "markdown" # Markdown report for documentation

# Quality Gates
qualityGates:
  failOnCritical: true
  maxCriticalIssues: 0
  maxHighIssues: 5
  maxMediumIssues: 20
  minTestCoverage: 0.8  # 80% of user journey must be tested

# Retry Configuration
retry:
  maxRetries: 2
  retryOnFailure: true
  retryDelay: 5000  # milliseconds
  exponentialBackoff: true

# Monitoring
monitoring:
  trackConsoleErrors: true
  trackNetworkFailures: true
  trackPerformanceMetrics: true
  trackMemoryUsage: true
  alertThreshold:
    memory: 500  # MB
    loadTime: 5000  # ms
